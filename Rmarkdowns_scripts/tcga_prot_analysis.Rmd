setwd("~/Dropbox/bild_signatures/multi_tcga_gene_list/")
filenames<-system("ls *gene_list/*/pathway_activity_testset*", intern=TRUE)

setwd("~/Dropbox/bild_signatures/tcga_BRCA_5_9/assign_1.0.0")
filenames<-system("ls */*/pathway_activity_testset*", intern=TRUE)


for(i in 1:length(filenames)){
  f<-read.csv(filenames[i], header=1,row.names=1) ###reading in the filess one at a time
  colnames(f)<-paste(filenames[i],colnames(f),sep='/')
    if(i!=1){
    data<-cbind(data,f)
    }
    else{
    data<-f
    }
}
colnames(data)<-gsub(pattern = "/pathway_activity_testset.csv",replacement = "",x = colnames(data))
prot<-read.csv("~/Dropbox/bild_signatures/Datasets/TCGA-BRCA-RBN.csv",header=1)
source("~/Dropbox/bild_signatures//bild_signatures/Rmarkdowns_scripts//Key_ASSIGN_functions.Rmd")
prot$TCGA_patient_barcode<-short_to_long_TCGA_id(shortnames=gsub(pattern="-",".",prot$TCGA_patient_barcode),longnames=rownames(data))
data_tcga_prot<-merge(data,prot,by.x=0,by.y=1)
cor_mat=p_mat=matrix(0,length(filenames),190)

rownames(cor_mat)=rownames(p_mat)=colnames(data_tcga_prot)[2:(length(filenames)+1)]
colnames(cor_mat)=colnames(p_mat)=colnames(data_tcga_prot)[(length(filenames)+5):ncol(data_tcga_prot)]
for(i in 2:(length(filenames)+1)){
  for(j in 1:190){
  print(j)
  temp=cor.test(data_tcga_prot[,i],data_tcga_prot[,j+18],use="pairwise",method="spearman")
  cor_mat[(i-1),j]=temp$estimate
  p_mat[(i-1),j]=temp$p.value
  }
}
colnames(p_mat)=paste(colnames(p_mat),"p_value",sep="_")
#write.table(cor_mat,"~/Dropbox/TCGA_single_protein_cor_mat_4_23.txt",col.names = NA,quote=F,sep='\t')
#write.table(p_mat,"~/Dropbox/TCGA_single_protein_p_mat_4_23.txt",col.names = NA,quote=F,sep='\t')
write.table(cor_mat,"~/Dropbox/bild_signatures/tcga_BRCA_5_9/TCGA_single_protein_cor_mat_4_23.txt",col.names = NA,quote=F,sep='\t')
######

akt_plus<-t(read.table("~/Dropbox/bild_signatures/tcga_BRCA_5_9/AKT_PLUS_brca_tcga_pub_brca_tcga_pub_gistic_fair.txt",sep='\t',row.names=1,header=1))
dim(akt_plus)
akt_plus_f<-as.matrix(akt_plus[2:484,])
rownames(akt_plus_f)<-short_to_long_TCGA_id(shortnames=rownames(akt_plus_f),longnames=rownames(data))
akt_pred<-merge_drop(akt_plus_f,data)
boxplot(akt_pred[,8]~akt_pred$PTEN)
sum(apply(akt_plus_f,1,sum)==0,na.rm=T)
boxplot(akt_pred[,8]~akt_pred$ERBB2)

akt_positives<-akt_pred[(akt_pred$PTEN<0&akt_pred$PIK3CA0&akt_pred$AKT1>=0&akt_pred$ERBB2>=0),]#&akt_pred$AKT2>=0&akt_pred$AKT3>=0),]
negatives<-[apply(akt_plus_f,1,sum)==0]
akt_negative<-akt_pred[(akt_pred$PTEN>=1&akt_pred$PIK3CA==0&akt_pred$AKT1==0&akt_pred$ERBB2==0),]#&&akt_pred$AKT2<=0&akt_pred$AKT3<=0),]
"TCGA.AR.A1AO.01A.11R.A12P.07"%in%rownames(akt_negative)
boxplot(akt_positives[,8],akt_negative[,8])
akt_minus<-short_to_long_TCGA_id(shortnames=rownames(akt_plus_f)[apply(akt_plus_f,1,sum)==0],longnames=rownames(data))
akt_high<-short_to_long_TCGA_id(shortnames=rownames(akt_plus_f)[apply(akt_plus_f,1,sum)!=0],longnames=rownames(data))
boxplot(data[rownames(data)%in%akt_high,2],data[rownames(data)%in%akt_minus,2],names=c("akt_high","akt_low"))

easy_akt<-read.table("~/Dropbox/bild_signatures/tcga_BRCA_5_9/easy_akt.txt", row.names=1)
rownames(easy_akt)<-short_to_long_TCGA_id(shortnames=gsub("-",".",rownames(easy_akt)),longnames=rownames(data))
easy_akt_data<-merge_drop(easy_akt,data)
boxplot(easy_akt_data[,3]~easy_akt_data[,1])
head(easy_akt_data)
